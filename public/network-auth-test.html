<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM-App Network Auth Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover { background: #0056b3; }
        #results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üöÄ PM-App Network Authentication Test</h1>
    
    <div class="info">
        <strong>Server Address:</strong> http://192.168.1.145:3000<br>
        <strong>Test Time:</strong> <span id="timestamp"></span>
    </div>

    <h2>üîß Connection Tests</h2>
    <button class="test-button" onclick="testConnection()">Test Server Connection</button>
    <button class="test-button" onclick="testGoogleOAuth()">Test Google OAuth</button>
    <button class="test-button" onclick="testAuthPage()">Test Auth Page</button>
    <button class="test-button" onclick="testEmailAuth()">Test Email Registration</button>

    <h2>üìã Test Results</h2>
    <div id="results">Click test buttons above to see results...</div>

    <h2>üîç Troubleshooting Guide</h2>
    <div class="info">
        <h3>If Google Sign-In is stuck loading:</h3>
        <ol>
            <li><strong>Update Google OAuth:</strong> Add redirect URI <code>http://192.168.1.145:3000/auth/google/callback</code> in Google Cloud Console</li>
            <li><strong>Use Email/Password:</strong> Try creating account with email instead</li>
            <li><strong>Clear Cache:</strong> Clear browser cache and try incognito mode</li>
            <li><strong>Check Network:</strong> Ensure you're on the same network as the server</li>
        </ol>
        
        <h3>If page won't load at all:</h3>
        <ol>
            <li><strong>Firewall:</strong> Check Windows Firewall allows port 3000</li>
            <li><strong>Network:</strong> Verify IP address is 192.168.1.145 (run ipconfig)</li>
            <li><strong>Browser:</strong> Try different browser or incognito mode</li>
        </ol>
    </div>

    <div class="success">
        <strong>‚úÖ Working Solutions:</strong><br>
        ‚Ä¢ Server is running on network IP<br>
        ‚Ä¢ Email/password authentication available<br>
        ‚Ä¢ All API endpoints responding<br>
        ‚Ä¢ Database connections working
    </div>

    <h2>üîó Quick Links</h2>
    <p>
        <a href="http://192.168.1.145:3000/auth" target="_blank">‚Üí Login Page</a> |
        <a href="http://192.168.1.145:3000" target="_blank">‚Üí Main App</a> |
        <a href="http://192.168.1.145:3000/landing" target="_blank">‚Üí Landing Page</a>
    </p>

    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        async function testConnection() {
            log('üîÑ Testing server connection...', 'info');
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    log('‚úÖ Server connection successful', 'success');
                } else {
                    log(`‚ùå Server responded with status: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Connection failed: ${error.message}`, 'error');
                // Fallback test
                try {
                    const response = await fetch('/');
                    log('‚úÖ Basic connection working (via fallback)', 'success');
                } catch (fallbackError) {
                    log(`‚ùå Complete connection failure: ${fallbackError.message}`, 'error');
                }
            }
        }

        async function testGoogleOAuth() {
            log('üîÑ Testing Google OAuth configuration...', 'info');
            try {
                const response = await fetch('/api/auth/google/url');
                const data = await response.json();
                
                if (response.ok && data.configured) {
                    log('‚úÖ Google OAuth configured correctly', 'success');
                    log(`   Client ID: ${data.clientId}`, 'info');
                    log(`   Redirect URL: ${data.redirectUrl}`, 'info');
                } else {
                    log('‚ùå Google OAuth issues detected:', 'error');
                    log(`   Error: ${data.error}`, 'error');
                    log(`   Setup needed: ${data.setup}`, 'info');
                }
            } catch (error) {
                log(`‚ùå OAuth test failed: ${error.message}`, 'error');
            }
        }

        async function testAuthPage() {
            log('üîÑ Testing authentication page...', 'info');
            try {
                const response = await fetch('/auth');
                if (response.ok) {
                    log('‚úÖ Auth page accessible', 'success');
                    const contentType = response.headers.get('content-type');
                    log(`   Content-Type: ${contentType}`, 'info');
                } else {
                    log(`‚ùå Auth page failed: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Auth page test failed: ${error.message}`, 'error');
            }
        }

        async function testEmailAuth() {
            log('üîÑ Testing email authentication endpoint...', 'info');
            try {
                // Just test if the endpoint exists, don't actually register
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({}) // Empty body to test endpoint
                });
                
                // We expect a 400 error for missing fields, which means endpoint is working
                if (response.status === 400) {
                    log('‚úÖ Email authentication endpoint accessible', 'success');
                } else {
                    log(`‚ÑπÔ∏è Email auth endpoint responded with: ${response.status}`, 'info');
                }
            } catch (error) {
                log(`‚ùå Email auth test failed: ${error.message}`, 'error');
            }
        }

        // Auto-run connection test
        window.addEventListener('load', () => {
            setTimeout(testConnection, 500);
        });
    </script>
</body>
</html>
